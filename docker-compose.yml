version: "3.8"

services:
        database:
                container_name: cup_database
                image: mysql
                restart: always
                networks:
                        - network_name
                environment: 
                - MYSQL_ROOT_PASSWORD= ${MYSQL_PASSWORD}
                - MYSQL_DATABASE= ${MYSQL_DATABASE}
                - MYSQL_USER= ${MYSQL_USER}
                - MYSQL_PASSWORD= ${MYSQL_PASSWORD}
                volumes:
                        - ./data:/docker-entrypoint-initdb.d/
        nginx:
                container_name: cup_nginx
                restart: always
                ports:
                        - 80:80
                build:
                        context: .
                        dockerfile: dockerfile
                volumes:
                        - ./nginx.conf:/etc/nginx/nginx.conf
                        - ./:/code
                networks:
                        - network_name
                links:
                - web-php
        phpmyadmin:
                container_name: cup_phpmyadmin
                image: phpmyadmin/phpmyadmin
                restart: always
                environment:
                - PMA_HOST = ${MYSQL_HOST}
                - PMA_ARBITRARY = 1
                depends_on:
                - database
                - web-php
                networks:
                        - network_name
                links:
                - web-php
        web-php:
                container_name: php8.1
                image: php:8.1-fpm
                restart: always
                expose:
                        - "9000"
                networks:
                        - network_name
                volumes:
                        - ./:/code

networks:
  network_name:

volumes:
        myapp:

